import React, { useEffect, useRef, useState } from 'react';

const BecomeAnAgent = () => {
    const sectionRef = useRef(null);
    const scrollableContentRef = useRef(null);
    const [isSticky, setIsSticky] = useState(false);
    const [isScrollable, setIsScrollable] = useState(false);

    useEffect(() => {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.boundingClientRect.top <= 0 && entry.isIntersecting) {
                    console.log('reacehs top')
                    setIsSticky(true);
                    document.body.classList.add('no-scroll');
                } else {
                    setIsSticky(false);
                    document.body.classList.remove('no-scroll');
                }
            });
        }, { rootMargin: '0px 0px -100% 0px', threshold: 0 });

        if (sectionRef.current) {
            observer.observe(sectionRef.current);
        }

        return () => {
            if (sectionRef.current) {
                observer.unobserve(sectionRef.current);
            }
            document.body.classList.remove('no-scroll');
        };
    }, []);

    useEffect(() => {
        const handleScroll = () => {
            if (scrollableContentRef.current) {
                const { scrollTop, scrollHeight, clientHeight } = scrollableContentRef.current;
                if (scrollTop + clientHeight >= scrollHeight) {
                    setIsScrollable(false);
                    setIsSticky(false);
                    document.body.classList.remove('no-scroll');
                }
            }
        };

        if (isSticky) {
            setIsScrollable(true);
            if (scrollableContentRef.current) {
                scrollableContentRef.current.addEventListener('scroll', handleScroll);
            }
        } else {
            setIsScrollable(false);
            if (scrollableContentRef.current) {
                scrollableContentRef.current.removeEventListener('scroll', handleScroll);
            }
        }

        return () => {
            if (scrollableContentRef.current) {
                scrollableContentRef.current.removeEventListener('scroll', handleScroll);
            }
        };
    }, [isSticky]);

    return (
        <section className={`sticky-container section bg-white w-full mx-auto ${isSticky ? 'sticky' : ''}`} ref={sectionRef} id="become-an-agent">
            <div>
                <h2 className="font-BebasNeueSemiExpBold text-4xl md:text-5xl text-primarycolor text-left">Become An Agent</h2>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-10 mt-10 mb-8">
                    <div className="px-0 lg:pr-12">
                        <img src="/images/homepage/becomeanagent.png" alt="Team collaboration" className="w-full rounded-lg" />
                    </div>
                    <div className={`scrollable-content ${isScrollable ? '' : 'overflow-hidden'}`} ref={scrollableContentRef}>
                        <div>
                            <div className='w-full h-[33px] flex items-center mb-4'>
                                <img src="/images/icons/users-alt.png" alt="" style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'cover' }} />
                            </div>
                            <h2 className="font-semibold text-xl md:text-2xl mb-2 text-primarycolor">Generate more clients</h2>
                            <p className="text-fontlight mb-6">
                                Unlock unparalleled success in real estate with our dynamic approach, leveraging advanced digital marketing strategies, personalized brand investment, international partnerships, and cutting-edge software solutions to supercharge your lead generation and propel your business to new heights.
                            </p>
                        </div>
                        <div>
                            <div className='w-full h-[37px] flex items-center mb-4'>
                                <img src="/images/icons/global.png" alt="" style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'cover' }} />
                            </div>
                            <h2 className="font-semibold text-xl md:text-2xl mb-2 text-primarycolor">Global Network</h2>
                            <p className="text-fontlight mb-6">
                                Our global network of partners consistently sends us high-quality clients. When you build connections with these partners, they can send you exclusive leads through our proprietary software. The possibilities are endless.
                            </p>
                        </div>
                        <div>
                            <div className='w-full h-[33px] flex items-center mb-4'>
                                <img src="/images/icons/heartt.png" alt="" style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'cover' }} />
                            </div>
                            <h2 className="font-semibold text-xl md:text-2xl mb-2 text-primarycolor">Build a World-Class Brand & Amplify Your Real Estate Following</h2>
                            <p className="text-fontlight mb-6">
                                Boost your brand and business with our full-service creative workshop and award-winning content studio. Leverage proven strategies and modern techniques that built the world's most followed real estate brand. Enhance your reach, tap into social media trends, and establish yourself as a leading voice in your market and globally.
                            </p>
                        </div>
                        <div>
                            <div className='w-full h-[30px] flex items-center mb-4'>
                                <img src="/images/icons/growth.png" alt="" style={{ maxHeight: '100%', maxWidth: '100%', objectFit: 'cover' }} />
                            </div>
                            <h2 className="font-semibold text-xl md:text-2xl mb-2 text-primarycolor">Professional & Personal Growth</h2>
                            <p className="text-fontlight mb-6">
                                We foster your growth both as a real estate agent and as an individual. Our passionate team supports and motivates each other daily to become the best versions of ourselves. More than just a business, we are a family.
                            </p>
                        </div>
                    </div>
                </div>
                <div className="text-center">
                    <button className="bg-primarycolor text-white text-center buttonLong">Join Us</button>
                </div>
            </div>
        </section>
    );
};

export default BecomeAnAgent;
